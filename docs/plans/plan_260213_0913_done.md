# Plan: Single-String GenerateAsync Convenience API ✅ DONE

**Created:** 2026-02-13 09:13  
**Status:** ✅ Completed (2026-02-13)

---

## Goal

Add developer-friendly single-string overloads so users can write:

```csharp
// Instead of: await generator.GenerateAsync(["Hello, world!"])  →  result[0]
var result = await generator.GenerateAsync("Hello, world!");
float[] embedding = result[0].Vector.ToArray();

// Or even simpler:
var embedding = await generator.GenerateEmbeddingAsync("Hello, world!");
```

Eliminate the array-wrap-then-index-zero boilerplate for the most common use case (single text).

---

## Phase 1: New Extension Methods

### Step 1 — Create `EmbeddingGeneratorExtensions.cs`

**File:** `src/ElBruno.LocalEmbeddings/EmbeddingGeneratorExtensions.cs`  
**Namespace:** `ElBruno.LocalEmbeddings` (main namespace — auto-discovered, no extra `using` needed)

New `public static class EmbeddingGeneratorExtensions` containing:

| Method | Signature | Returns | Behavior |
|--------|-----------|---------|----------|
| `GenerateAsync` | `this IEmbeddingGenerator<string, Embedding<float>> generator, string value, EmbeddingGenerationOptions? options = null, CancellationToken ct = default` | `Task<GeneratedEmbeddings<Embedding<float>>>` | Delegates to `generator.GenerateAsync([value], options, ct)` |
| `GenerateEmbeddingAsync` | `this IEmbeddingGenerator<string, Embedding<float>> generator, string value, EmbeddingGenerationOptions? options = null, CancellationToken ct = default` | `Task<Embedding<float>>` | Calls `GenerateAsync` then returns `result[0]` |

Both methods:

- Validate `generator` and `value` with `ArgumentNullException.ThrowIfNull`
- Include full XML doc comments with `<example>` blocks
- Live in the **`ElBruno.LocalEmbeddings`** namespace

**Why extension methods on the interface, not instance methods on `LocalEmbeddingGenerator`?** Extensions on `IEmbeddingGenerator<string, Embedding<float>>` work through DI where users receive the interface, not the concrete type.

---

## Phase 2: Tests

### Step 2 — Add tests in `LocalEmbeddingGeneratorTests.cs`

**File:** `tests/ElBruno.LocalEmbeddings.Tests/LocalEmbeddingGeneratorTests.cs`

Integration tests (existing `SkippableFact` + `[Trait("Category", "Integration")]` pattern):

| Test | Validates |
|------|-----------|
| `GenerateAsync_SingleString_ReturnsSingleEmbedding` | `GenerateAsync("Hello world")` returns 1 embedding with 384 dims |
| `GenerateAsync_SingleString_NullValue_ThrowsArgumentNullException` | Null string argument throws |
| `GenerateEmbeddingAsync_ReturnsSingleEmbedding` | `GenerateEmbeddingAsync("Hello world")` returns `Embedding<float>` with 384 dims |
| `GenerateEmbeddingAsync_NullValue_ThrowsArgumentNullException` | Null string argument throws |
| `GenerateEmbeddingAsync_MatchesBatchResult` | Result of `GenerateEmbeddingAsync("text")` equals `GenerateAsync(["text"])[0]` (vector equality) |

Unit tests (always run, no model needed):

| Test | Validates |
|------|-----------|
| `GenerateAsync_SingleString_NullGenerator_ThrowsArgumentNullException` | Extension method guards null `this` |
| `GenerateEmbeddingAsync_NullGenerator_ThrowsArgumentNullException` | Extension method guards null `this` |

---

## Phase 3: Update Samples

### Step 3 — Update `samples/ConsoleApp/Program.cs`

Replace the first single-embedding example to use the new API:

```csharp
await generator.GenerateAsync("Hello, world!")
```

Keep the batch example (`GenerateAsync(documents)`) to show both patterns.

### Step 4 — Update `samples/HelloWorldAltModel/Program.cs`

Simplify single-text embedding call to use `GenerateAsync("text")` or `GenerateEmbeddingAsync("text")`.

### Step 5 — Audit remaining samples

- `samples/RagChat/Program.cs` — simplify query embedding calls (`GenerateEmbeddingAsync(query)`)
- `samples/RagOllama/Program.cs` — simplify if applicable
- `samples/RagFoundryLocal/Program.cs` — simplify if applicable

---

## Phase 4: Update Documentation

### Step 6 — Update `README.md`

- Update Quick Start snippet to use `GenerateAsync("Hello, world!")`
- Add "Single-String Convenience API" to Features list

### Step 7 — Update `docs/api-reference.md`

- Add `EmbeddingGeneratorExtensions` section with both methods, signatures, parameters, and examples
- Cross-reference from `LocalEmbeddingGenerator` section

### Step 8 — Update `docs/getting-started.md`

- Step 1 (Hello World): use `GenerateEmbeddingAsync("text")`
- Step 2 (Similarity): use `GenerateEmbeddingAsync` for query embedding
- Step 4 (Semantic Search): use `GenerateEmbeddingAsync(query)` for query side
- Keep batch usage where batching is the point

### Step 9 — Update `samples/README.md`

Mention the new single-string API in sample descriptions if applicable.

---

## Files Affected

| File | Action |
|------|--------|
| `src/ElBruno.LocalEmbeddings/EmbeddingGeneratorExtensions.cs` | **CREATE** |
| `tests/ElBruno.LocalEmbeddings.Tests/LocalEmbeddingGeneratorTests.cs` | **MODIFY** — add 7 tests |
| `samples/ConsoleApp/Program.cs` | **MODIFY** |
| `samples/HelloWorldAltModel/Program.cs` | **MODIFY** |
| `samples/RagChat/Program.cs` | **MODIFY** |
| `samples/RagOllama/Program.cs` | **AUDIT** |
| `samples/RagFoundryLocal/Program.cs` | **AUDIT** |
| `README.md` | **MODIFY** |
| `docs/api-reference.md` | **MODIFY** |
| `docs/getting-started.md` | **MODIFY** |
| `samples/README.md` | **MODIFY** |

---

## Verification

1. `dotnet build` — zero warnings (TreatWarningsAsErrors)
2. `dotnet test` — all new tests pass
3. IntelliSense shows `GenerateAsync(string)` and `GenerateEmbeddingAsync(string)` on any `IEmbeddingGenerator<string, Embedding<float>>` without extra `using`
4. `dotnet run --project samples/ConsoleApp` — end-to-end check

---

## Decisions

- **Namespace:** `ElBruno.LocalEmbeddings` (main) — auto-discovered, best DX
- **Extension methods on interface** — works through DI
- **Separate file** `EmbeddingGeneratorExtensions.cs` — keeps concern separation from `EmbeddingExtensions` (vector math)
- **Scope excludes:** No changes to `LocalEmbeddingGenerator` class, no KernelMemory changes, no version bump (additive)

---

## Roadmap Reference

This plan implements **roadmap item #15 (Single-String Convenience API)** added to [roadmap_260213_0803.md](roadmap_260213_0803.md).
