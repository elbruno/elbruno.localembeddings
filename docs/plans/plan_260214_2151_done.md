# Plan — Implement Roadmap Item #2 (SIMD / TensorPrimitives) ✅ DONE

Date: 2026-02-14 21:51  
**Status:** ✅ Completed (2026-02-14)

## Goal

Implement roadmap item [2. SIMD / TensorPrimitives for Similarity & Normalization](./roadmap_260213_0803.md#2-simd--tensorprimitives-for-similarity--normalization) using minimal, behavior-preserving changes.

## Scope

- Replace scalar cosine similarity math with `TensorPrimitives.CosineSimilarity`.
- Replace scalar L2 normalization math with `TensorPrimitives.Norm` + `TensorPrimitives.Divide`.
- Add `System.Numerics.Tensors` package reference in the main library project.
- Add a focused unit test for cosine similarity against known vectors.
- Update roadmap item #2 and summary rows to reflect completed work.

## Non-Goals

- Introducing public API changes.
- Refactoring unrelated embedding generation logic.
- Adding benchmark/sample work from other roadmap items.

## Implementation Steps

1. Update `EmbeddingExtensions.CosineSimilarity(ReadOnlyMemory<float>, ReadOnlyMemory<float>)` to use `TensorPrimitives`.
2. Update `OnnxEmbeddingModel.L2Normalize(float[])` to use `TensorPrimitives`.
3. Add/update tests in `EmbeddingExtensionsTests` for a known-value cosine similarity scenario.
4. Validate with `dotnet build` and `dotnet test`.
5. Mark roadmap item #2 as done and reflect completion in matrix/order sections.

## Acceptance Criteria

- SIMD-backed operations are used for cosine similarity and L2 normalization.
- Existing behavior remains unchanged for valid and edge-case inputs.
- Tests pass after changes (`dotnet build` + `dotnet test` from repo root).
- Roadmap item #2 is updated as completed with references to the implementation plan.

## Files Expected to Change

- `src/ElBruno.LocalEmbeddings/Extensions/EmbeddingExtensions.cs`
- `src/ElBruno.LocalEmbeddings/OnnxEmbeddingModel.cs`
- `src/ElBruno.LocalEmbeddings/ElBruno.LocalEmbeddings.csproj`
- `tests/ElBruno.LocalEmbeddings.Tests/EmbeddingExtensionsTests.cs`
- `docs/plans/roadmap_260213_0803.md`
- `docs/plans/plan_260214_2151_done.md` (this file)
